<!DOCTYPE html><html><head><title data-react-helmet="true">Node定时任务怎么做 - 前端网</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="baidu-site-verification" content="code-TlaecuFEx5">
    <meta name="sogou_site_verification" content="wMb3kHjFi6">
    <meta name="shenma-site-verification" content="19dfe33fcd6f20294164ba6738d0e102_1634534936">
    <meta name="360-site-verification" content="e943e2d7714355d2d1af8f36b12c41f9">
    <meta name="baidu_union_verify" content="6f7381d4136832e99f86da0d67739a46">
    <meta name="bytedance-verification-code" content="d+FL9L0/4KxPwFbqXgmT">

    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2087076429727327"
    crossOrigin="anonymous"></script> -->
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="/umi.css">
    <link rel="stylesheet" href="/layouts.chunk.css">
    <link rel="stylesheet" href="/p__blogs__detail__detail.chunk.css">
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.5.18
    </script>
    <title>文章详情</title>
  <meta data-react-helmet="true" name="description" content="前端网,node,egg,定时任务,node-schedule,linux有crontab定时任务，那么在Node中，定时任务该如何实现?"><meta data-react-helmet="true" name="keywords" content="前端网,node,egg,定时任务,node-schedule">
</head>

  <body>
    <div id="root"><header class="header___2_57M"><img alt="farmerLZJ" class="title___MhkPP" src="/static/logo.68ff92ec.png"/></header><div style="width:100%;position:relative;top:0;z-index:999"><nav class="nav___3wfA1"><a href="https://izejun.com/blogs" class="item___AqKVH active___1THnk">博客</a></nav></div><div class="content___2QN8t"><div class="content___1G4Bw"><header><a href="https://izejun.com/" class="back___26SyS undefined"> <!-- -->首页</a> <!-- -->/<a href="https://izejun.com/blogs" class="back___26SyS undefined"> <!-- -->博客</a></header><article><h1>Node定时任务怎么做</h1>

<h2>背景</h2>

<p>目前我们遇到了这样一个需求，每个用户都可以自定义定时推送，定时任务的时间配置由用户自己配置，随时修改，而不是传统的由服务器设定好时间跑定时任务。</p>

<p>如果是已知定时任务循环周期，那么Linux Crontab 定时任务即可实现。在node中也已经有相对成熟的方案。下面将我自己了解到的Node定时任务方案方案做一个介绍。</p>

<h2>egg框架提供的schduler定时任务</h2>

<p>egg是阿里旗下的Node企业级应用框架，它提供了一套机制给开发者优雅的编写定时任务，详细参考官方文档：&lt;a rel=&quot;nofollow&quot;&gt;https://eggjs.org/zh-cn/basics/schedule.html&lt;/a&gt; ，这里不对具体用法做详细阐述，只简单讲一下它的配置用法。</p>

<p>1.静态定时任务，即定时周期，处理逻辑写死。</p>

<p>2.动态配置定时任务，这种相对来说灵活一点，开发者可以通过配置文件控制定时任务周期。</p>

<p>3.通过代码手动触发定时任务，我们可以根据一些逻辑判断是否触发定时任务。</p>

<p>从上述三点看，egg提供的定时任务不能满足我们需要用户自行配置定时周期的需求，所以只能寻求其他方案，通过查询资料我们发现了node-schedule的库也提供了定时任务的功能。</p>

<h2>node-schedule</h2>

<p>在浏览了node-schudule的文档 &lt;a rel=&quot;nofollow&quot;&gt;https://www.npmjs.com/package/node-schedule&lt;/a&gt; 之后，他的用法如下:</p>

<p><code></code>`</p>

<p>const schedule = require(&#39;node-schedule&#39;);</p>

<p>const job = schedule.scheduleJob(&#39;42 <em> </em> <em> </em>&#39;, function(){
  console.log(&#39;The answer to life, the universe, and everything!&#39;);
});</p>

<p><code></code>`
是的，他支持自定义定时周期，可以满足我们的需求，可以作为我们的选择，Nice!</p>

<p>继续浏览其他开发者的使用文章，发现有一个node-schedule的相关问题记录，简要说就是定时器在预定时间执行了2次，具体问题见原文：&lt;a rel=&quot;nofollow&quot;&gt;https://cnodejs.org/topic/5b58414b8d66b90b2b7384a7&lt;/a&gt; 。这是一个低概率的问题，我们没有去做验证，因为我们的需求，及时定时器执行两次，对我们的结果并没有影响，所以这不是阻碍我们使用它的障碍，有兴趣的同学可以去测测bug。</p>

<h2>写在最后</h2>

<p>最后这里是对我们自己项目定时定时任务解决方案的总结，不感兴趣的同学可略过。</p>

<p>我们的后端就是用的egg框架，所以最后我们的解决方案是在agent进程中加了node-schdule的定时器，用户的定时器都会同步的agent进程中执行，目前我们的用户量不大，暂时只想到了这种解决方式，后续起量后可能会分布式部署后台，这会是一个问题，量大的话单进程跑也会是一个问题，并且egg本身不建议在agent进程中做太多业务相关的东西。还有个比较重要的是agent是辅助进程，一些work的公共工作实在agent中完成的，agent发生未捕获的错误不会退出重启，所以容错处理必须要做，而且要做好。</p>

<p>如果你有更好的方案，欢迎 <a href="https://qianduan.shop/aboutUs">留言</a> 告诉我们。</p></article><div><span class="ant-tag ant-tag-geekblue">#<span>node</span></span><span class="ant-tag ant-tag-volcano">#<span>egg</span></span><span class="ant-tag ant-tag-error">#<span>定时任务</span></span><span class="ant-tag ant-tag-success">#<span>node-schedule</span></span></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><ins class=" adsbygoogle" style="display:block;text-align:center;width:100%;height:90px" data-ad-client="ca-pub-2087076429727327" data-ad-slot="9331479126" data-ad-layout="" data-ad-layout-key="" data-ad-format="auto" data-full-width-responsive="false"></ins></div><div class="container___8WoUM"><p class="title___3k8xL">Online Tools</p><div class="tool_tags___1ccK5"><span class="ant-tag ant-tag-blue tool_tag___1JT6M">JSON Formater</span><span class="ant-tag ant-tag-cyan tool_tag___1JT6M">MD5</span><span class="ant-tag ant-tag-error tool_tag___1JT6M">timestamps</span><span class="ant-tag ant-tag-green tool_tag___1JT6M">Cron Expresstion</span></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><div style="text-align:center;height:300px"><ins class=" adsbygoogle" style="display:inline-block;width:250px;height:300px" data-ad-client="ca-pub-2087076429727327" data-ad-slot="7022357395" data-ad-layout="" data-ad-layout-key="" data-ad-format="auto" data-full-width-responsive="false"></ins></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><div style="text-align:center;height:300px"><ins class=" adsbygoogle" style="display:inline-block;width:250px;height:300px" data-ad-client="ca-pub-2087076429727327" data-ad-slot="7022357395" data-ad-layout="" data-ad-layout-key="" data-ad-format="auto" data-full-width-responsive="false"></ins></div></div></div><footer class="footer___3wR6c">©2021 farmerlzj 提供技术支持 | 联系我们：farmerlzj@163.com |<!-- --> <a href="https://beian.miit.gov.cn/" rel="nofollow" target="_blank">蜀ICP备2021025378号-1</a></footer><div class="ant-back-top"></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="https://cloud.qianduan.shop/react.min.js"></script>
    <script src="https://cloud.qianduan.shop/react-dom.min.js"></script>
    <script src="/umi.js"></script>
    <script src="/layouts.js"></script>
    <script src="/p__blogs__detail__detail.js"></script>
  

</body></html>